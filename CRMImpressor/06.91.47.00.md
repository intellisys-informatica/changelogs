# CRMImpressor

# :file_folder: 06.91.47.00

## :memo: O que foi alterado?

<details open>
<summary>Resumo</summary>

- :star: O método `AgendaMensagem.InserirNotApp` foi modificado para lidar com a nova estrutura da tabela `MOBILEMENSAGEM`
- :warning: É necessário que a tablea `MOBILEMENSAGEM` esteja devidamente atualizada

</details>

:star: Novo
:warning: Correção
:arrow_up: Melhoria

<details open>
<summary>Detalhes</summary>

:star: Centralização dos dados do Push em `MOBILEMENSAGEM`

`AgendaMensagem.InserirNotApp` Busca e agrega todos os dados necessários para o disparo de um Push e centraliza tudo em um registro em `MOBILEMENSAGEM`
Caso o cliente que receberá o push tenha vários registros em PushId (Vários dispositivos) cada PushId vai se tornar um registro independente em `MOBILEMENSAGEM`

</details>

## :cd: Banco de dados

<details open>
<summary>Resumo</summary>

- Atualização em `MOBILEMENSAGEM`

</details>

<details open>
<summary>Detalhes</summary>

Colunas novas para armazenamento de informações para tornar a tabela autossuficiente

- mobmsgtokendestino: Token para envio do push, agora a mensagem é por token ou seja se cada cliente tiver mais de um token na tabela `ClientesPushID` será agenda uma mensagem para cada token.
- mobmsgagrupamento: Código que servirá de agrupamento do envio, caso o cliente tenha mais de um `ClientesPushID` será criado uma messagem para cada token e as mensagem receberão nessa coluna um identificador para agrupar os envios.
- mobmsgconteudoextra: Coluna para armazenar conteudos extras que é enviado pelo Push Notification de forma oculta.
- mobmsgtiposistema: O sistema operacional do token, isso sinaliza para o enviador para qual empresa enviar a mensagem. 1 - IOS; 3 - Android.

</details>

<details open>
<summary>Scripts</summary>

**MOBILEMENSAGEM**

ALTER TABLE mobilemensagem add(mobmsgtokendestino VARCHAR(255),
                                mobmsgagrupamento VARCHAR(36),
                                mobmsgconteudoextra VARCHAR2(4000),
                                mobmsgtiposistema NUMBER(10));

</details>

## :wrench: Configurações necessárias

Nenhuma configuração adicional necessária.
