# ICRMWeb

# :file_folder: 6.90.45.40

## :memo: O que foi alterado?

<details open>
<summary>Resumo</summary>

- **PAGE_TableCampanha** (13/08/2025):
  - Os botões `Sorteios` e `Prêmios` agora estão abrindo as páginas corretas.
  - O botão `Gerar Nro Sorte` agora não executa nenhuma ação se o parâmetro `PARNUMEROSORTECORRETORA` estiver ativo.

    <details> 
    <summary>Solicitação</summary>

    `4444` - Ajustes para a nova campanha do tipo 39 - Número da Sorte por Produtos.

    </details>

  - Os botões nessa tela voltaram a respeitar o template de restrição.

    <details> 
      <summary>Solicitação</summary>

      `4607` - Rotina de bloqueio de grupo e usuário

    </details>

  - Ajuste para exibir a descrição correta da campanha nova a `46 - Premiação no PDV`

- **PAGE_FormCampanha** (13/08/2025):
  
  - Foi Criado uma nova campanha a `46 - Premiação no PDV`
  
- **PAGE_FilterCampanha** (13/08/2025):
  
  - Foi adiconado a nova campanha a `46 - Premiação no PDV`, no combo de tipo

- **PAGE_LiberaCuponsDescontoImportacao** (13/08/2025):
  
  - Faz a importação de cupons de desconto semelhante a campanha 38

- **PAGE_ViewCupDescontos** (14/08/2025):

  - Botão novo, `Entrega`, para entregar o cupom de desconto sorteado no pdv 

- :star: **PAGE_FormEntregaCupDesconto** (14/08/2025):
 
  - Tela nova para dá baixa nos cupons de desconto sorteado pelo pdv

</details>

<details open>
<summary>Detalhes</summary>

Foi solicitado que a campanha 39 se comporte de forma idêntica à campanha 22.  
Para isso, foram ajustados os botões `Sorteios` e `Prêmios` para terem o mesmo comportamento da campanha 22.

Além disso, no botão `Gerar Nro Sorte`, foi adicionada uma verificação no parâmetro `PARNUMEROSORTECORRETORA`.  
Caso ele esteja ativo, a seguinte mensagem é exibida:

> `"O método de geração e associação de números da sorte é de responsabilidade da Corretora."`

Essas alterações foram realizadas conforme a solicitação `4444`.

Recentemente houve um ajuste na visualização dos botões na `PAGE_TableCampanha`, porem não atentamos a funcionamento do template de restrição. nesta versão os botões desta página voltaram a respeitar o template de restrição. Essa alteração foi realizada conforme a solicitação `4607`.

Foi criada uma nova campanha, a `46 - Premiação no PDV`, uma campanha de sorteio de cupons de desconto liberada no momenta da compra no pdv. Ela é atrelada a uma campanha 24 que é responsável em gerar os cupons que serão sorteado na campanha 46 similar as campaha 7, 38 e 40, em um horário espessífico é liberado um cupons de desconto e o primeiro cliente a comprar, ganha esse cupom. Pra isso alteramos o filtro para exibir essa opção nova, a tabela para se coomporta semelhante a campanha 38, e formulário pra conter os campos necessário para essa campanha funcionar.

Após o cliente ganhar será necessário entregar no cupom de desconto, então, na página `PAGE_ViewCupDescontos` (**Fidelização>Processos>Campanhas:Cupom Desconto**) criamos um botão novo chamado `Entrega` que chama uma nova página `PAGE_FormEntregaCupDesconto` para realizar a entrega ao cliente, associando ao cpf ou a um cartão padrão configurado no parâmetro `PARCARTAOPADRAOCUPSORTEIO`, lembrando que esse cartão não precisa existir em nosso sistema, ou a um cartão externo.

</details>

## :cd: Banco de dados

Não consta.

<details open>
<summary>Resumo</summary>
</details>

<details open>
<summary>Detalhes</summary>
</details>

<details open>
<summary>Scripts</summary>
</details>

## :wrench: Configurações necessárias

Para configurar a campanha `46 - Premiação no PDV`, é necessário:
  
  - Criar uma nova campanha desse tipo 46.
  - Inserir a descrição.
  - Informar a mala direta (caso necessário).
  - Definir a data de início e a data de fim.
  - Informar a data de fim da troca de cupom (equivalente ao encerramento da campanha).
  - Definir o valor mínimo para ter a chance de ganhar um cupom de desconto
  - Configurar a quantidade de dias para o fim da campanha — ou seja, quantos dias após o encerramento ainda será possível comprar e usar o cupom (caso necessário).
  - Informar a quantidade máxima de cupons de desconto que será gerada pela campanha 24.
  - Definir o valor mínimo da compra para usar o cupom de desconto (caso necessário).
  - Informar a soma total de descontos equivalente ao valor máximo que poderá ser gerado pela campanha 24 (caso necessário).
  - Inserir o rodapé que será impresso no cupom de desconto (caso necessário).
  - após confirmar, na página da tabela de campanha clicar em `Processar Campanha`, nesse momento será criado a campanha 24.
  - Após processar campanha, importar um arquivo com os cupons de desconto com os horário de sorteio, clicando em `importar cupom Deconto`.

O arquivo de importação deve ser um `.xls/.xlsx` com as seguintes colunas. 


| LOJA | VALOR (R$) | QUANTIDADE | DATA | HORA INÍCIO | HORA FIM | HORA SORTEIO
|---|---|---|---|---|---|--|

Os títulos das colunas são validadas para considerar um arquivo válido.
- LOJA - Número da loja que o cupom de desconto será sorteado
- VALOR (R$) - O valor do cupom de desconto
- QUANTIDADE - qauntidade de cupons de desconto que será liberado nessa configuração
  - normalmente se coloca 1 porem existe a possibilidade de geração aleatória, onde se diz a quantidade, o dia e a hora de início e fim, dessa forma os cupons receberão aleatoriamente uma horário de liberação
- DATA - dia que os cupons serão liberados
- HORA INÍCIO - Funciona juntamente com a `HORA FIM` para determinar uma horário aleatório para a liberação do cupom de desconto
- HORA FIM - Funciona juntamente com a `HORA INÍCIO` para determinar uma horário aleatório para a liberação do cupom de desconto
- HORA SORTEIO - determina a hora exata do sorteio despresando a informação da `HORA INÍCIO` e `HORA FIM`.

Para utilizar um cartão padrão na página de entrega de cupom de sorteio (`PAGE_FormEntregaCupDesconto`) é necessário configurar o parâmetro `PARCARTAOPADRAOCUPSORTEIO` com um cartão que não precisa existir em nosso sistema, Ele só servirá para facilitar a busca por cupons entregues.