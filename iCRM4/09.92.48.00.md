# iCRM4

# :file_folder: 09.92.48.00

## :memo: O que foi alterado?

<details open>
<summary>Resumo</summary>

- :star: Exibição de campos de macro substituição com tooltip explicativo
- :star: Criação de campos para integração com Pontal Tech
- :star: Personalização de nome do cartão - Campo configurável por bandeira

</details>

:star: Novo
:warning: Correção
:arrow_up: Melhoria

<details open>
<summary>Detalhes</summary>

:star: **Exibição de campos de macro substituição com tooltip explicativo**

Criado um looper que preenche com os campos de macrosubstituição cadastrado no utils. Acrescentado tooltip com interrogação com explicação.

:star: **Criação de campos para integração com Pontal Tech**

Efetuado criação de duas novas colunas na tabela TB_SERVICESENDER:
- SVCSNDEMAILIDCLIENTE - VARCHAR2(100) - ID Cliente (Pontaltech)
- SVCSNDEMAILIDCONTA - VARCHAR2(100) - ID Conta (Pontaltech)

**Ajustes realizados:**
- Modelo ModeloServiceDeComunicacao acrescentado as duas novas colunas SVCSNDEMAILIDCLIENTE e SVCSNDEMAILIDCONTA
- Tela PAGE_PainelServiceDeComunicao no plane 3 Visualização e no plane 4 Edição/Inserção contém os novos dois campos ID Cliente e ID Conta
- Classe TipoApiEmail acrescentada a quarta constante CNS_PONTAL_TECH que representa: 4 - PONTAL-TECH

:star: **Personalização de nome do cartão - Campo configurável por bandeira**

Inserção do campo "Nome Cartão Personalizado" na tela PAGE_Painel_Bandeira no plane form e no plane view quando a bandeira é do tipo 6 - GIFT

</details>

## :cd: Banco de dados

Houve alterações no banco de dados.

<details open>
<summary>Resumo</summary>

- Criadas duas novas colunas na tabela TB_SERVICESENDER para integração com Pontal Tech
- Adicionada coluna para armazenar nome personalizado do cartão na tabela TB_BANDEIRA

</details>

<details open>
<summary>Detalhes</summary>

### Tabela TB_SERVICESENDER

Adicionadas colunas para armazenar informações de integração com o serviço Pontal Tech:
- **SVCSNDEMAILIDCLIENTE** (VARCHAR2(100)) - Armazena o ID do Cliente no Pontaltech
- **SVCSNDEMAILIDCONTA** (VARCHAR2(100)) - Armazena o ID da Conta no Pontaltech

### Tabela TB_BANDEIRA

Adicionada coluna para permitir a personalização do nome exibido no cartão Gift:
- **BNDNOMECARTAOPERSONALIZADO** (VARCHAR2(100)) - Nome Personalizado para ser impresso no cartão

</details>

<details open>
<summary>Scripts</summary>

```sql
ALTER TABLE TB_SERVICESENDER ADD SVCSNDEMAILIDCLIENTE VARCHAR2(100);
ALTER TABLE TB_SERVICESENDER ADD SVCSNDEMAILIDCONTA VARCHAR2(100);
ALTER TABLE TB_BANDEIRA ADD BNDNOMECARTAOPERSONALIZADO VARCHAR2(100);

COMMENT ON COLUMN TB_SERVICESENDER.SVCSNDEMAILIDCLIENTE IS 'ID Cliente (Pontaltech)';
COMMENT ON COLUMN TB_SERVICESENDER.SVCSNDEMAILIDCONTA IS 'ID Conta (Pontaltech)';
COMMENT ON COLUMN TB_BANDEIRA.BNDNOMECARTAOPERSONALIZADO IS 'Nome Personalizado para ser impresso no cartão';
```

</details>

## :wrench: Configurações necessárias

**OBS1:** Necessário gerar versão do Utils.

**OBS2:** Necessário gerar versão do iCRM4.

**OBS3:** Para a integração com Pontal Tech:
- Configurar os campos ID Cliente e ID Conta na tela Configurações → Serviços → Comunicação
- Obter as credenciais (ID Cliente e ID Conta) junto ao provedor Pontal Tech
- Selecionar o tipo de API Email como "4 - PONTAL-TECH" nas configurações de serviço de comunicação
